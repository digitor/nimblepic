"use strict";!function(){function getDynamicHeight(src,srcIsSelector,cb){!function(src,srcIsSelector,cb){setTimeout(function(){srcIsSelector&&(src=$(src).css("background-image").replace("url(","").replace(")","").replace('"','"').replace("'","'"));var img=new Image;img.onload=function(){cb(src,!0,this.height)},img.onerror=function(){SELF.suppressWarnings||console.warn("image error",this.src),cb(src,!1)},img.src=src},100)}(src,srcIsSelector,cb)}function responsiveImage(type,srcSm,srcMd,sel,heightSm,heightMd,heightLg,clearExisting,customID,grad,throwWarning,addNoImgClass){var supportsGrad=window.Modernizr&&window.Modernizr.cssgradients;"undefined"!=typeof window.Modernizr&&window.Modernizr&&void 0!==window.Modernizr.cssgradients||(SELF.suppressWarnings||console.warn("Utils.js","responsiveImage","'Modernizr.cssgradients' was not availale, which older browsers, such as ie9 need in order for this function to work properly."),supportsGrad=!1),supportsGrad||(grad=null);var css,id=customID||DEF_SRC_STYLE_ID;if(!type||"viewport"===type){if(!srcSm||!srcMd||!sel)return void(SELF.suppressWarnings||console.warn(NS,"responsiveImage","You must define srcSm, srcMd & sel"));clearExisting&&clearExistingStyles(sel,id,throwWarning,addNoImgClass),css=sel+" { background-image:"+(grad?grad+",":"")+"url("+srcMd+")"+(grad?"!important":"")+";",heightMd&&(css+="height: "+heightMd+"px;"),css+="}",css+="@media only screen and (max-width: 767px) {",css+=sel+" {background-image:"+(grad?grad+",":"")+"url("+srcSm+")"+(grad?"!important":"")+";",heightSm&&(css+="height: "+heightSm+"px;"),css+="}",css+=sel+".no-mb { background-image: "+(grad||"none")+(grad?"!important":"")+"; }",css+="}",heightLg&&(css+="@media only screen and (min-width: 992px) {",css+=sel+" {",grad&&(css+="background-image:"+grad+",url("+srcMd+")"+(grad?"!important":"")+";"),css+="height: "+heightLg+"px;",css+="}}")}return addStyle(id,css),id}function responsiveHeight(justClear,customID,sel,heightSm,heightMd,heightLg,clearExisting,throwWarning,addNoImgClass){var id=customID||DEF_H_STYLE_ID;if(!justClear&&!clearExisting||(clearExistingStyles(sel,id,throwWarning,addNoImgClass),!justClear)){var css="";return heightMd&&(css=sel+"{",css+="height: "+heightMd+"px;",css+="}"),heightSm&&(css+="@media only screen and (max-width: 767px) {",css+=sel+"{",css+="height: "+heightSm+"px;",css+="}}"),heightLg&&(css+="@media only screen and (min-width: 992px) {",css+=sel+"{",css+="height: "+heightLg+"px;",css+="}}"),addStyle(id,css),id}}function clearExistingStyles(sel,id,throwWarning,addNoImgClass){var styleEl=document.getElementById(id),elList=document.querySelectorAll(sel),foundExisting=!0;if(addNoImgClass){foundExisting=!1;for(var img,cls,i=0;i<elList.length;i++){img=elList[0];for(var j=0;j<img.classList.length;j++)if(cls=img.classList[j],cls.indexOf("-sibling")===cls.length-8){img.classList.add(CLS_NO_IMG),foundExisting=!0;break}}}return throwWarning=!!(throwWarning&&styleEl&&foundExisting),throwWarning&&!SELF.suppressWarnings&&console.warn(NS,"clearExistingStyles()","WARNING: You have cleared existing images with selector '"+sel+"' and style element of ID '"+id+"'."),styleEl&&document.body.removeChild(styleEl),throwWarning}function addStyle(id,css){if(0===$("#"+id).length){var styleTag='<style type="text/css" id="'+id+'" data-resp-styles >'+css+"</style>",$existing=$("[data-resp-styles]");$existing.length?$existing.last().after(styleTag):$("body").prepend(styleTag)}else $("#"+id).append(css)}function responsiveWidth(breakName,isMoreThan,andIsEqual){var w=winWidth(),logic=function(val){return isMoreThan?andIsEqual?w>=val:w>val:andIsEqual?val>=w:val>w};switch(breakName){case"xs":return logic(480);case"sm":return logic(768);case"md":return logic(992);case"lg":return logic(1200)}}function getResponsiveWidth(){var w=winWidth();return 480>w?"xs":768>w?"sm":992>w?"md":"lg"}function winWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getUID(pref){var uid=(pref||"")+Math.random().toString().replace(".",""),firstChar=uid.substr(0,1);return"NaN"!==parseInt(firstChar).toString()&&(uid="a-"+uid),uid}function getImgProps(img){var srcSm=img.getAttribute("data-img-sm")||null,srcMd=img.getAttribute("data-img-md")||null,hSm=img.getAttribute("data-height-sm"),hMd=img.getAttribute("data-height-md"),hLg=img.getAttribute("data-height-lg"),customEvent=img.getAttribute("data-delay-image-load-event"),group=img.getAttribute("data-img-group");return hSm=hSm&&"NaN"!==parseInt(hSm).toString()?parseInt(hSm):null,hMd=hMd&&"NaN"!==parseInt(hMd).toString()?parseInt(hMd):null,hLg=hLg&&"NaN"!==parseInt(hLg).toString()?parseInt(hLg):null,{srcSm:srcSm,srcMd:srcMd,hSm:hSm,hMd:hMd,hLg:hLg,customEvent:customEvent||null,group:group||null}}function addLoader($img){var img=$img[0],ldrCls=clsPrf+"-ldr";if(img.classList.contains(CLS_IS_IMG_LOADING))return!0;var ldrEl,customCls=img.getAttribute("data-loader");img.querySelector("."+ldrCls)||(ldrEl=document.createElement("span"),ldrEl.classList.add(ldrCls),customCls&&ldrEl.classList.add(customCls),img.appendChild(ldrEl)),ldrEl=img.querySelector("."+ldrCls);var computedStyle=window.getComputedStyle(ldrEl);return-1!==computedStyle.getPropertyValue("background-image").indexOf(".gif")&&img.classList.add("is-gifldr"),!1}function getSpecificSelector(parentCls,cls){return(parentCls?"."+parentCls+" ":"")+"."+cls}function getCustomStyleId(customStyleID,invalidSrc,group,customEvent){var uid=getUID();return customEvent?customEvent:group?group:invalidSrc?customStyleID?customStyleID+"-"+uid:DEF_SRC_STYLE_ID+"-"+uid:customStyleID||null}function setUniqueImgClass(existingSel,img,index,group,customEvent){if(customEvent||group){"number"!=typeof index&&(SELF.suppressWarnings||console.warn(NS,"setUniqueImgClass","Argument 'index' was not a valid number. Defaulting to '0'."),index=0);var uniqueCls=getUID("nimblepic-custom-"+index+"-");return img.classList.add(uniqueCls),"."+uniqueCls}return existingSel}function isInvalidSrc(srcSm,srcMd){return"object"==typeof srcSm&&(srcMd=srcSm.srcMd,srcSm=srcSm.srcSm),"string"!=typeof srcSm&&(srcSm=!1),"string"!=typeof srcMd&&(srcMd=!1),!srcSm&&!srcMd}function isInvalidResponsiveSrc($img,srcSm,srcMd){var breakPointSize=getResponsiveWidth(),invalidSrc=isInvalidSrc(srcSm,srcMd);if(invalidSrc)return!0;var approvedSrc="sm"===breakPointSize||"xs"===breakPointSize?srcSm:srcMd;return approvedSrc&&"string"==typeof approvedSrc?!1:($img[0].classList.add(CLS_NO_IMG),$img.data(D_CUR_IMG_SRC,null),!0)}function setCustomEventHandler(customEvent,cb,$img,srcSm,srcMd,specificSel,hSm,hMd,hLg,uid,styleId){$(document).one(customEvent,function(evt,data){data&&data.refresh&&(srcSm=$img.attr("data-img-sm"),srcMd=$img.attr("data-img-md")),cb($img,srcSm,srcMd,specificSel,hSm,hMd,hLg,uid,styleId,!0,data?data.cb:null)})}function setLoadingStates(img,state){img.classList.remove(CLS_NO_IMG),img.classList.remove(CLS_IS_IMG_LOADED),img.classList.remove(CLS_IS_IMG_LOADING),"loading"===state?img.classList.add(CLS_IS_IMG_LOADING):"loaded"===state&&img.classList.add(CLS_IS_IMG_LOADED)}var SELF,nimblePic,NS="nimblePic",DEF_SRC_STYLE_ID="nimpic-src-styles",DEF_H_STYLE_ID="nimpic-h-styles",clsPrf="nimpic",defClsPrf=clsPrf,CLS_NO_IMG="no-img",D_CUR_IMG_SRC="current-image-src",CLS_IS_IMG_LOADING="is-imgloading",CLS_IS_IMG_LOADED="is-imgloaded";nimblePic={suppressWarnings:!1,setDefaultImageClass:function(_clsPrf,reset){return reset?(clsPrf=defClsPrf,!0):"string"!=typeof _clsPrf?(SELF.suppressWarnings||console.warn(NS,"setDefaultImageClass","The class name supplied was not a valid string."),!1):(_clsPrf=_clsPrf.match(/[A-Za-z0-9-_]+/g).join(""),_clsPrf.length?"NaN"!==parseInt(_clsPrf.substr(0,1),10).toString()?(SELF.suppressWarnings||console.warn(NS,"setDefaultImageClass","A CSS class name cannot start with a number. Returning early."),!1):clsPrf=_clsPrf:(SELF.suppressWarnings||console.warn(NS,"setDefaultImageClass","The class name was a empty string. Maybe some invalid characters were used and removed. Returning early."),!1))},clearStyles:function(styleIds){if(styleIds&&!styleIds.length)return void(SELF.suppressWarnings||console.warn(NS,"clearStyles","If supplied, argument 'styleIds' must be an array of IDs to clear. Returning early.",styleIds));var elList;if(styleIds){elList=[];for(var i=0;i<styleIds.length;i++){var styleEl=document.getElementById(styleIds[i]);styleEl?elList.push(styleEl):SELF.suppressWarnings||console.warn(NS,"clearStyles","Couldn't find style element with ID "+styleIds[i])}}else elList=document.querySelectorAll("style[data-resp-styles]");for(var i=0;i<elList.length;i++)document.body.removeChild(elList[i])},setImages:function($,$container,customCls,customStyleID,parentCls,loadedCB){$||($=window.$);var clearExistingSrc=!0,clearExistingHeights=!0,UID=getUID(),startLoading=function($img,srcSm,srcMd,specificSel,hSm,hMd,hLg,uid,styleId,isGroupOrEvent,cb){if(uid!==UID)return void console.warn(NS,"startLoading","UIDs did not match",uid,UID);var breakPointSize=getResponsiveWidth(),isMb="sm"===breakPointSize||"xs"===breakPointSize,thisSrc=isMb?srcSm:srcMd;$img.data(D_CUR_IMG_SRC,thisSrc),getDynamicHeight(thisSrc,!1,function(url,isSuccess,nativeHeight){var hSmall=hSm||nativeHeight,hMedium=hMd||nativeHeight,hLarge=hLg,clearExisting=isGroupOrEvent?!1:clearExistingSrc,throwWarning=!1,addNoImgClass=!1;if(isGroupOrEvent||(clearExistingSrc=!1),setLoadingStates($img[0],"loaded"),isSuccess){var grad=$img.attr("data-grad")||null;responsiveImage(null,srcSm,srcMd,specificSel,hSmall,hMedium,hLarge,clearExisting,styleId,grad,throwWarning,addNoImgClass),$img.removeClass(CLS_NO_IMG)}else $img.addClass(CLS_NO_IMG);var computedHeight=isMb?hSmall:hMedium;"lg"===breakPointSize&&hLarge&&(computedHeight=hLarge),cb&&cb(isSuccess,url,$img[0],computedHeight,nativeHeight),loadedCB&&loadedCB(isSuccess,url,$img[0],computedHeight,nativeHeight)})};customCls||(customCls=clsPrf),$container||($container=$(document)),$(function(){var prp,singleCls,$img,$list=$container.find("."+customCls);return loadedCB&&!$list.length?void loadedCB(!1,"no images found"):void $list.each(function(i){if(prp=getImgProps(this),!prp.srcSm||!prp.srcMd)return SELF.suppressWarnings||console.warn(NS,"setImages()","Data attributes 'data-img-sm' and 'data-img-md' were not set. These are mandatory. Adding 'no-img' class to element ",this),this.classList.add(CLS_NO_IMG),void addLoader($(this));singleCls=customCls+"-"+i+"-sibling",this.classList.add(singleCls),$img=$container.find("."+singleCls);var isLoading=addLoader($img);if(!isLoading){prp.srcSm&&""!==prp.srcSm&&prp.srcSm===prp.srcMd&&(SELF.suppressWarnings||console.warn(NS,"setImages()","'srcSm' and 'srcMd' should not be the same url! Kind of defeats the purpose of using NimblePic.",prp.srcSm));var invalidSrc=isInvalidSrc(prp),specificSel=getSpecificSelector(parentCls,singleCls),styleId=getCustomStyleId(customStyleID,invalidSrc,prp.group,prp.customEvent);specificSel=setUniqueImgClass(specificSel,$img[0],i,prp.group,prp.customEvent),responsiveHeight(!1,styleId,specificSel,prp.hSm,prp.hMd,prp.hLg,clearExistingHeights,!0,!0),prp.group||prp.customEvent||(clearExistingHeights=!1),invalidSrc=isInvalidResponsiveSrc($img,prp.srcSm,prp.srcMd),invalidSrc||(setLoadingStates(this,"loading"),prp.customEvent?setCustomEventHandler(prp.customEvent,startLoading,$img,prp.srcSm,prp.srcMd,specificSel,prp.hSm,prp.hMd,prp.hLg,UID,styleId):startLoading($img,prp.srcSm,prp.srcMd,specificSel,prp.hSm,prp.hMd,prp.hLg,UID,styleId,!!prp.group,null))}})})},testable:{getDynamicHeight:getDynamicHeight,getResponsiveWidth:getResponsiveWidth,winWidth:winWidth,getUID:getUID,addStyle:addStyle,responsiveWidth:responsiveWidth,responsiveHeight:responsiveHeight,responsiveImage:responsiveImage,getImgProps:getImgProps,addLoader:addLoader,getSpecificSelector:getSpecificSelector,getCustomStyleId:getCustomStyleId,isInvalidSrc:isInvalidSrc,isInvalidResponsiveSrc:isInvalidResponsiveSrc,setCustomEventHandler:setCustomEventHandler,setUniqueImgClass:setUniqueImgClass,clearExistingStyles:clearExistingStyles},vars:{NS:NS,DEF_SRC_STYLE_ID:DEF_SRC_STYLE_ID,clsPrf:clsPrf,defClsPrf:defClsPrf,CLS_NO_IMG:CLS_NO_IMG,D_CUR_IMG_SRC:D_CUR_IMG_SRC,CLS_IS_IMG_LOADING:CLS_IS_IMG_LOADING,CLS_IS_IMG_LOADED:CLS_IS_IMG_LOADED}},"undefined"==typeof window?module.exports=nimblePic:window.nimblePic=window.nimblepic=window.nimpic=window.nipplepic=window.nipplePic=nimblePic,SELF=nimblePic}();